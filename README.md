# Hotlapping Mod - Структура и установка

## Статус разработки

- ✅ **Этап 1**: Базовая структура проекта
- ✅ **Этап 2**: Система управления точками (Waypoint System)
- ✅ **Этап 3**: Детектор пересечения линии (Line Crossing Detector)
- ✅ **Этап 4**: Система таймера и учета кругов (Lap Timer System)
- ⏳ **Этап 5**: Локальное хранилище (Local Storage) - В планах

## Возможности мода

### Текущий функционал:

1. **Установка финишной линии**
   - Установка двух точек (A и B) для создания линии старт-финиш
   - Визуализация линии с клетчатым паттерном (как настоящий финиш)
   - Маркеры точек с текстовыми метками

2. **Детектирование пересечения**
   - Точное определение момента пересечения линии
   - Определение направления (вперед/назад)
   - Игнорирование движения задним ходом

3. **Таймер и учет кругов**
   - Автоматический старт таймера при первом пересечении
   - Завершение круга и начало нового при каждом пересечении
   - Отображение текущего времени в реальном времени
   - Хранение истории кругов с временами
   - Определение и отображение лучшего круга
   - Уведомления о завершении круга и новых рекордах

4. **Интерфейс**
   - Простой и понятный UI с кнопками установки точек
   - Отображение статуса конфигурации
   - Блокировка недоступных кнопок
   - Отображение текущего, последнего и лучшего времени
   - История последних 5 кругов
   - Подсветка лучшего круга в истории

## Структура мода

Для правильной работы мода в BeamNG.drive архив должен содержать следующие файлы:

```
Hotlapping.zip (или имя вашего мода)
├── mod_info.json                           ✅ Манифест мода
├── scripts/
│   └── hotlapping/
│       └── modScript.lua                   ✅ Загрузчик расширения
├── lua/
│   └── ge/
│       └── extensions/
│           ├── Hotlapping.lua              ✅ Главное расширение
│           └── Hotlapping/
│               └── WaypointManager.lua     ✅ Модуль точек
└── ui/
    └── modules/
        └── apps/
            └── hotlapping/
                ├── app.json                ✅ Манифест UI приложения
                ├── app.html                ✅ HTML интерфейс
                ├── app.js                  ✅ Angular контроллер
                └── app.css                 ✅ Стили
```

## Критически важные файлы

### 1. `scripts/hotlapping/modScript.lua`
Без этого файла BeamNG не загрузит расширение!
```lua
local _ = load('Hotlapping')
setExtensionUnloadMode('Hotlapping', 'manual')
log('I', 'modScript', 'Hotlapping mod loaded successfully')
```

### 2. `ui/modules/apps/hotlapping/app.json`
Без этого файла UI приложение не зарегистрируется!
```json
{
  "name": "Hotlapping",
  "directive": "hotlapping",
  "domElement": "<hotlapping-app></hotlapping-app>",
  ...
}
```

## Установка

1. Создайте ZIP архив со структурой выше
2. Поместите в папку:
   - `Documents/BeamNG.drive/mods/` (для обычной игры)
   - `Documents/BeamNG.drive/0.XX/mods/` (для конкретной версии)
3. Запустите BeamNG.drive
4. Откройте приложение через меню Apps (F11)

## Как открыть UI приложение

1. Нажмите `F11` для открытия меню приложений
2. Найдите "Hotlapping" в категории "Gameplay"
3. Кликните на иконку для открытия

Или через консоль:
```
ui_message({type = "openApp", appName = "Hotlapping"})
```

## Отладка

Если мод не работает, проверьте лог файл:
`Documents/BeamNG.drive/beamng.log`

Ищите строки с:
- `[modScript] Hotlapping mod loaded successfully`
- `[Hotlapping]` - логи расширения
- Ошибки загрузки

## Упаковка в ZIP

При создании архива убедитесь что:
- Файлы находятся в корне ZIP, а не в подпапке
- Структура папок правильная (scripts/, lua/, ui/)
- Все файлы включены

Неправильно:
```
Hotlapping.zip
  └── Hotlapping/
      ├── mod_info.json
      └── ...
```

Правильно:
```
Hotlapping.zip
  ├── mod_info.json
  ├── scripts/
  ├── lua/
  └── ui/
```
